import unittest
import sys
import xml.etree.ElementTree as ET
sys.path.append('services/XMLConverterService')
from XMLConverterService import XMLGenerator


class ConverterTests(unittest.TestCase):

    converter = XMLGenerator()

    def testparseEvents(self):
        root = ET.parse('Tests/test_XML/BXFShort.xml')
        val = self.converter.parseEvents(root)
        self.assertEqual(val, [])

    def testgenerateSchedule(self):
        meta = {'name': 'aname', 'startTime': 1, 'endTime': 2}
        inputs = [{'order': 1, 'uid': 1, 'uri': 1},
                  {'order': 2, 'uid': 2, 'uri': 2}]
        val = self.converter.generateSchedule(4, meta, inputs)
        self.assertEqual(val.find('./input/order').text, '1')

    def testGenerateUpdate(self):
        inputs = [{'order': 1, 'uid': 1, 'uri': 1},
                  {'order': 2, 'uid': 2, 'uri': 2}]
        val = self.converter.generateUpdate(inputs)
        self.assertEqual(val.find('./input/order').text, '1')

    def testgenerateEventWithtwoInputs(self):
        meta = {'name': 'aname', 'startTime': 1, 'endTime': 2}
        inputs = [{'order': 1, 'uid': 1, 'uri': 1},
                  {'order': 2, 'uid': 2, 'uri': 2}]
        val = self.converter.generateEvent(meta, inputs, 4)
        self.assertEqual(val.find('./input/order').text, '1')

    def testgenerateEventWithOneInput(self):
        meta = {'name': 'aname', 'startTime': 1, 'endTime': 2}
        inputs = [{'order': 1, 'uid': 1, 'uri': 1}]
        val = self.converter.generateEvent(meta, inputs, 4)
        self.assertEqual(val.find('./input/order').text, '1')

    def testBadValidate(self):
        bad_xml = "<a><b></b></c>"
        self.assertEqual(self.converter.validateXML(bad_xml),
                         'StatusCode: 400: Not valid .xml structure')

    def testGoodValidate(self):
        good_xml = "<a><b></b></a>"
        self.assertEqual(self.converter.validateXML(
            good_xml), 'StatusCode: 200')

    def testconvertEvent(self):
        xml = '<?xml version="1.0" encoding="ISO-8859-1"?><BxfMessage xmlns="http://smpte-ra.org/schemas/2021/2008/BXF" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pmcp="http://www.atsc.org/XMLSchemas/pmcp/2007/3.1" id="urn:uuid:6d7a271f-7fd8-40f2-9b3b-329ee4c2afcd" dateTime="2011-09-07T11:49:34.22" messageType="Information" origin="Traffic System" originType="Traffic" userName="Traffic System User" destination="Automation" xsi:schemaLocation="http://smpte-ra.org/schemas/2021/2008/BXF BxfSchema.xsd"><BxfData action="add"><Schedule type="Primary" scheduleId="urn:uuid:7af7ac59-57b2-4d40-9ace-0dc337e534a6" ScheduleStart="2011-09-07T00:00:00.00" ScheduleEnd="2011-09-07T23:59:46.05" action="add"><Channel channelNumber="0-1" status="active" type="digital_television" ca="false" shortName="WBCC" outOfBand="true" action="add"><pmcp:Name lang="eng" action="add">WBCC CHANNEL TV68/DT68-1</pmcp:Name></Channel><ScheduleName>WBCC_09072011_1315410574</ScheduleName><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</EventId></EventId><PrimaryEvent><ProgramEvent><SegmentNumber>0</SegmentNumber><ProgramName>GROWING A GREENER WORLD</ProgramName></ProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Fixed</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>50006</HouseNumber></ContentId><Name>GROWING A GREENER WORLD</Name><Description>GROWING A GREENER WORLD</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>1080i</Format><AspectRatio>16:9</AspectRatio><PrivateInformation><ScreenFormatText>HD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:15:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content><ContentType>0</ContentType><Series><SeriesName>GROWING A GREENER WORLD</SeriesName><EpisodeName>BACKYARD CHICKENS (RALEIGH, NC &amp; LOS ANGELES, CA)</EpisodeName><EpisodeCode>210</EpisodeCode></Series></ScheduledEvent><ScheduledEvent><EventData eventType="NonPrimary" action="add"><EventId><EventId>urn:uuid:e618de18-9787-445f-ab4f-f0f7764ad1a7</EventId></EventId><NonPrimaryEvent><NonPrimaryEventName>SI</NonPrimaryEventName><PrimaryEventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</PrimaryEventId><Offset offsetFrom="BeginningofEvent" offsetType="Start" direction="Positive"><OffsetTime><SmpteTimeCode>00:01:00:00</SmpteTimeCode></OffsetTime></Offset><Macros><MacroName>LOGO4               </MacroName></Macros><NonProgramEvents><Details><SpotType>SI</SpotType></Details></NonProgramEvents></NonPrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:01:00:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>LOGO4</HouseNumber></ContentId><Name>STATION BUG - TRANSPARENT</Name><Description>STATION BUG - TRANSPARENT</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="NonPrimary" action="add"><EventId><EventId>urn:uuid:60d273d1-fcc5-474d-b518-5c54dc510699</EventId></EventId><NonPrimaryEvent><NonPrimaryEventName>SI</NonPrimaryEventName><PrimaryEventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</PrimaryEventId><Offset offsetFrom="BeginningofEvent" offsetType="Start" direction="Positive"><OffsetTime><SmpteTimeCode>00:25:46:00</SmpteTimeCode></OffsetTime></Offset><Macros><MacroName>LOGO4               </MacroName></Macros><NonProgramEvents><Details><SpotType>SI</SpotType></Details></NonProgramEvents></NonPrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:25:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>LOGO4OFF</HouseNumber></ContentId><Name>STATION BUG - TRANSPARENT</Name><Description>STATION BUG - TRANSPARENT</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:b3c3e3fe-280c-43fd-830a-8abe838e6f8e</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>207-94</HouseNumber></ContentId><Name>NEW BEGINNINGS SD C4V6B</Name><Description>NEW BEGINNINGS SD C4V6B</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>16:9</AspectRatio><PrivateInformation><ScreenFormatText>SD-LB</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:57d6bdf4-a5f3-4756-9bc6-b09819cd1bc9</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:27:16:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-324</HouseNumber></ContentId><Name>BCC FACULTY PROMO - PAT FULLER 30 C1V1</Name><Description>BCC FACULTY PROMO - PAT FULLER 30 C1V1</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:8c702615-f1f6-428e-a8e2-4f88f596659d</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:27:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:59:28</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>207-115</HouseNumber></ContentId><Name>BCC WILL MAKE YOU MOVE</Name><Description>BCC WILL MAKE YOU MOVE</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:59:28</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:740f8073-da93-4231-b7c7-fe69527d3d90</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:28:45:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-214</HouseNumber></ContentId><Name>B - HANNAH ALLEN @ BEACH</Name><Description>B - HANNAH ALLEN @ BEACH</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:2e001c0e-6548-4fd8-a388-fcc5461b6aab</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:29:15:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-247</HouseNumber></ContentId><Name>A - FACULTY SUSAN PHILLIPS CUT 1</Name><Description>A - FACULTY SUSAN PHILLIPS CUT 1</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:b6d99b03-4baa-47c7-a6e9-fb002cd3552f</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>ID</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:29:45:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:14:02</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>3-6</HouseNumber></ContentId><Name>NEW ID #6 (:10 - :30)</Name><Description>NEW ID #6 (:10 - :30)</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:14:02</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent></Schedule></BxfData></BxfMessage>'
        self.assertEqual(self.converter.convertEvent(xml, '4'), "<?xml version='1.0' encoding='UTF-8'?>\n<live_event><name>WBCC_09072011_1315410574</name><input><name>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</name><order>1</order><file_input><uri>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</uri></file_input></input><input><name>urn:uuid:e618de18-9787-445f-ab4f-f0f7764ad1a7</name><order>2</order><file_input><uri>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</uri></file_input></input><node_id>3</node_id><profile>4</profile></live_event>")

    def testconvertSchedule(self):
        xml = '<?xml version="1.0" encoding="ISO-8859-1"?><BxfMessage xmlns="http://smpte-ra.org/schemas/2021/2008/BXF" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pmcp="http://www.atsc.org/XMLSchemas/pmcp/2007/3.1" id="urn:uuid:6d7a271f-7fd8-40f2-9b3b-329ee4c2afcd" dateTime="2011-09-07T11:49:34.22" messageType="Information" origin="Traffic System" originType="Traffic" userName="Traffic System User" destination="Automation" xsi:schemaLocation="http://smpte-ra.org/schemas/2021/2008/BXF BxfSchema.xsd"><BxfData action="add"><Schedule type="Primary" scheduleId="urn:uuid:7af7ac59-57b2-4d40-9ace-0dc337e534a6" ScheduleStart="2011-09-07T00:00:00.00" ScheduleEnd="2011-09-07T23:59:46.05" action="add"><Channel channelNumber="0-1" status="active" type="digital_television" ca="false" shortName="WBCC" outOfBand="true" action="add"><pmcp:Name lang="eng" action="add">WBCC CHANNEL TV68/DT68-1</pmcp:Name></Channel><ScheduleName>WBCC_09072011_1315410574</ScheduleName><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</EventId></EventId><PrimaryEvent><ProgramEvent><SegmentNumber>0</SegmentNumber><ProgramName>GROWING A GREENER WORLD</ProgramName></ProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Fixed</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>50006</HouseNumber></ContentId><Name>GROWING A GREENER WORLD</Name><Description>GROWING A GREENER WORLD</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>1080i</Format><AspectRatio>16:9</AspectRatio><PrivateInformation><ScreenFormatText>HD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:15:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content><ContentType>0</ContentType><Series><SeriesName>GROWING A GREENER WORLD</SeriesName><EpisodeName>BACKYARD CHICKENS (RALEIGH, NC &amp; LOS ANGELES, CA)</EpisodeName><EpisodeCode>210</EpisodeCode></Series></ScheduledEvent><ScheduledEvent><EventData eventType="NonPrimary" action="add"><EventId><EventId>urn:uuid:e618de18-9787-445f-ab4f-f0f7764ad1a7</EventId></EventId><NonPrimaryEvent><NonPrimaryEventName>SI</NonPrimaryEventName><PrimaryEventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</PrimaryEventId><Offset offsetFrom="BeginningofEvent" offsetType="Start" direction="Positive"><OffsetTime><SmpteTimeCode>00:01:00:00</SmpteTimeCode></OffsetTime></Offset><Macros><MacroName>LOGO4               </MacroName></Macros><NonProgramEvents><Details><SpotType>SI</SpotType></Details></NonProgramEvents></NonPrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:01:00:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>LOGO4</HouseNumber></ContentId><Name>STATION BUG - TRANSPARENT</Name><Description>STATION BUG - TRANSPARENT</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="NonPrimary" action="add"><EventId><EventId>urn:uuid:60d273d1-fcc5-474d-b518-5c54dc510699</EventId></EventId><NonPrimaryEvent><NonPrimaryEventName>SI</NonPrimaryEventName><PrimaryEventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</PrimaryEventId><Offset offsetFrom="BeginningofEvent" offsetType="Start" direction="Positive"><OffsetTime><SmpteTimeCode>00:25:46:00</SmpteTimeCode></OffsetTime></Offset><Macros><MacroName>LOGO4               </MacroName></Macros><NonProgramEvents><Details><SpotType>SI</SpotType></Details></NonProgramEvents></NonPrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:25:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>LOGO4OFF</HouseNumber></ContentId><Name>STATION BUG - TRANSPARENT</Name><Description>STATION BUG - TRANSPARENT</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:b3c3e3fe-280c-43fd-830a-8abe838e6f8e</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>207-94</HouseNumber></ContentId><Name>NEW BEGINNINGS SD C4V6B</Name><Description>NEW BEGINNINGS SD C4V6B</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>16:9</AspectRatio><PrivateInformation><ScreenFormatText>SD-LB</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:57d6bdf4-a5f3-4756-9bc6-b09819cd1bc9</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:27:16:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-324</HouseNumber></ContentId><Name>BCC FACULTY PROMO - PAT FULLER 30 C1V1</Name><Description>BCC FACULTY PROMO - PAT FULLER 30 C1V1</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:8c702615-f1f6-428e-a8e2-4f88f596659d</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:27:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:59:28</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>207-115</HouseNumber></ContentId><Name>BCC WILL MAKE YOU MOVE</Name><Description>BCC WILL MAKE YOU MOVE</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:59:28</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:740f8073-da93-4231-b7c7-fe69527d3d90</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:28:45:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-214</HouseNumber></ContentId><Name>B - HANNAH ALLEN @ BEACH</Name><Description>B - HANNAH ALLEN @ BEACH</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:2e001c0e-6548-4fd8-a388-fcc5461b6aab</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:29:15:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-247</HouseNumber></ContentId><Name>A - FACULTY SUSAN PHILLIPS CUT 1</Name><Description>A - FACULTY SUSAN PHILLIPS CUT 1</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:b6d99b03-4baa-47c7-a6e9-fb002cd3552f</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>ID</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:29:45:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:14:02</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>3-6</HouseNumber></ContentId><Name>NEW ID #6 (:10 - :30)</Name><Description>NEW ID #6 (:10 - :30)</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:14:02</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent></Schedule></BxfData></BxfMessage>'
        self.assertEqual(self.converter.convertSchedule(xml, '4'), "<?xml version='1.0' encoding='UTF-8'?>\n<schedule><name>WBCC_09072011_1315410574</name><node_id>3</node_id><profile>4</profile><start_time>2011-09-07T00:00:00.00</start_time><end_time>2011-09-07T23:59:46.05</end_time><input><order>2</order><file_input><certificate_file>urn:uuid:e618de18-9787-445f-ab4f-f0f7764ad1a7</certificate_file><uri>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</uri></file_input></input><input><order>3</order><file_input><certificate_file>urn:uuid:60d273d1-fcc5-474d-b518-5c54dc510699</certificate_file><uri>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</uri></file_input></input></schedule>")

    def testconvertUpdate(self):
        xml = '<?xml version="1.0" encoding="ISO-8859-1"?><BxfMessage xmlns="http://smpte-ra.org/schemas/2021/2008/BXF" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pmcp="http://www.atsc.org/XMLSchemas/pmcp/2007/3.1" id="urn:uuid:6d7a271f-7fd8-40f2-9b3b-329ee4c2afcd" dateTime="2011-09-07T11:49:34.22" messageType="Information" origin="Traffic System" originType="Traffic" userName="Traffic System User" destination="Automation" xsi:schemaLocation="http://smpte-ra.org/schemas/2021/2008/BXF BxfSchema.xsd"><BxfData action="add"><Schedule type="Primary" scheduleId="urn:uuid:7af7ac59-57b2-4d40-9ace-0dc337e534a6" ScheduleStart="2011-09-07T00:00:00.00" ScheduleEnd="2011-09-07T23:59:46.05" action="add"><Channel channelNumber="0-1" status="active" type="digital_television" ca="false" shortName="WBCC" outOfBand="true" action="add"><pmcp:Name lang="eng" action="add">WBCC CHANNEL TV68/DT68-1</pmcp:Name></Channel><ScheduleName>WBCC_09072011_1315410574</ScheduleName><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</EventId></EventId><PrimaryEvent><ProgramEvent><SegmentNumber>0</SegmentNumber><ProgramName>GROWING A GREENER WORLD</ProgramName></ProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Fixed</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>50006</HouseNumber></ContentId><Name>GROWING A GREENER WORLD</Name><Description>GROWING A GREENER WORLD</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>1080i</Format><AspectRatio>16:9</AspectRatio><PrivateInformation><ScreenFormatText>HD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:15:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content><ContentType>0</ContentType><Series><SeriesName>GROWING A GREENER WORLD</SeriesName><EpisodeName>BACKYARD CHICKENS (RALEIGH, NC &amp; LOS ANGELES, CA)</EpisodeName><EpisodeCode>210</EpisodeCode></Series></ScheduledEvent><ScheduledEvent><EventData eventType="NonPrimary" action="add"><EventId><EventId>urn:uuid:e618de18-9787-445f-ab4f-f0f7764ad1a7</EventId></EventId><NonPrimaryEvent><NonPrimaryEventName>SI</NonPrimaryEventName><PrimaryEventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</PrimaryEventId><Offset offsetFrom="BeginningofEvent" offsetType="Start" direction="Positive"><OffsetTime><SmpteTimeCode>00:01:00:00</SmpteTimeCode></OffsetTime></Offset><Macros><MacroName>LOGO4               </MacroName></Macros><NonProgramEvents><Details><SpotType>SI</SpotType></Details></NonProgramEvents></NonPrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:01:00:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>LOGO4</HouseNumber></ContentId><Name>STATION BUG - TRANSPARENT</Name><Description>STATION BUG - TRANSPARENT</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="NonPrimary" action="add"><EventId><EventId>urn:uuid:60d273d1-fcc5-474d-b518-5c54dc510699</EventId></EventId><NonPrimaryEvent><NonPrimaryEventName>SI</NonPrimaryEventName><PrimaryEventId>urn:uuid:058ff320-2044-4c71-9f90-f6ef3234f53a</PrimaryEventId><Offset offsetFrom="BeginningofEvent" offsetType="Start" direction="Positive"><OffsetTime><SmpteTimeCode>00:25:46:00</SmpteTimeCode></OffsetTime></Offset><Macros><MacroName>LOGO4               </MacroName></Macros><NonProgramEvents><Details><SpotType>SI</SpotType></Details></NonProgramEvents></NonPrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:25:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>LOGO4OFF</HouseNumber></ContentId><Name>STATION BUG - TRANSPARENT</Name><Description>STATION BUG - TRANSPARENT</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:24:46:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:b3c3e3fe-280c-43fd-830a-8abe838e6f8e</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:26:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>207-94</HouseNumber></ContentId><Name>NEW BEGINNINGS SD C4V6B</Name><Description>NEW BEGINNINGS SD C4V6B</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>16:9</AspectRatio><PrivateInformation><ScreenFormatText>SD-LB</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:57d6bdf4-a5f3-4756-9bc6-b09819cd1bc9</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:27:16:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-324</HouseNumber></ContentId><Name>BCC FACULTY PROMO - PAT FULLER 30 C1V1</Name><Description>BCC FACULTY PROMO - PAT FULLER 30 C1V1</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:8c702615-f1f6-428e-a8e2-4f88f596659d</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:27:46:00</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:59:28</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>207-115</HouseNumber></ContentId><Name>BCC WILL MAKE YOU MOVE</Name><Description>BCC WILL MAKE YOU MOVE</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:59:28</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:740f8073-da93-4231-b7c7-fe69527d3d90</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:28:45:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-214</HouseNumber></ContentId><Name>B - HANNAH ALLEN @ BEACH</Name><Description>B - HANNAH ALLEN @ BEACH</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:2e001c0e-6548-4fd8-a388-fcc5461b6aab</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>FI</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:29:15:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>206-247</HouseNumber></ContentId><Name>A - FACULTY SUSAN PHILLIPS CUT 1</Name><Description>A - FACULTY SUSAN PHILLIPS CUT 1</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:30:00</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent><ScheduledEvent><EventData eventType="Primary" action="add"><EventId><EventId>urn:uuid:b6d99b03-4baa-47c7-a6e9-fb002cd3552f</EventId></EventId><PrimaryEvent><NonProgramEvent><Details><SpotType>ID</SpotType></Details></NonProgramEvent></PrimaryEvent><StartDateTime><SmpteDateTime broadcastDate="2011-09-07"><SmpteTimeCode>00:29:45:28</SmpteTimeCode></SmpteDateTime></StartDateTime><LengthOption><Duration><SmpteDuration frameRate="30"><SmpteTimeCode>00:00:14:02</SmpteTimeCode></SmpteDuration></Duration></LengthOption><StartMode>Follow</StartMode><EndMode>Duration</EndMode><Transitions><VideoTransitions><TransitionOutType>Cut</TransitionOutType><TransitionOutRate>Medium</TransitionOutRate></VideoTransitions></Transitions></EventData><Content><ContentId><HouseNumber>3-6</HouseNumber></ContentId><Name>NEW ID #6 (:10 - :30)</Name><Description>NEW ID #6 (:10 - :30)</Description><Media><PrecompressedTS><TSVideo><DigitalVideo>true</DigitalVideo><Format>480i</Format><AspectRatio>4:3</AspectRatio><PrivateInformation><ScreenFormatText>SD-FF</ScreenFormatText></PrivateInformation></TSVideo><TSCaptioning>true</TSCaptioning></PrecompressedTS><MediaLocation><Location><AssetServer playoutAllowed="true" fileTransferAllowed="true"><PathName>http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4</PathName><ReferenceName/></AssetServer></Location><SOM><SmpteTimeCode>00:00:00:00</SmpteTimeCode></SOM><Duration><SmpteDuration><SmpteTimeCode>00:00:14:02</SmpteTimeCode></SmpteDuration></Duration></MediaLocation></Media></Content></ScheduledEvent></Schedule></BxfData></BxfMessage>'
        self.assertEqual(self.converter.convertUpdate(
            xml, '058ff320-2044-4c71-9f90-f6ef3234f53a'), "<?xml version='1.0' encoding='UTF-8'?>\n<inputs />")

    # def testWriteToFile(self):
    #     xml = "<?xml version='1.0' encoding='utf-8'?>\n<live_event>\n  <name>testX</name>\n  <profile>test_profile</profile>\n  <node_id>3</node_id>\n  <input>\n    <order>1</order>\n    <file_input>\n      <uri>https://s3-us-west-2.amazonaws.com/pdxteamdkrakatoa/big_buck_bunny.mp4</uri>\n    </file_input>\n  </input>\n</live_event>"
    #     root = ET.parse('Tests/test_XML/live_event.xml')
    #     self.converter.writetofile(root)
    #     with open('testliveProfile.xml') as f:
    #         fileXml = f.read()
    #     self.assertEqual(xml, fileXml)

    def testGenerateProfile(self):
        self.assertEqual(ET.tostring(self.converter.generateProfile(
            'test').getroot()), '<live_event_profile><name>test</name><failure_rule><priority>50</priority><restart_on_failure>false</restart_on_failure><backup_rule>none</backup_rule></failure_rule><stream_assembly><name>SA1</name><video_description><height>720</height><width>1280</width><codec>h.264</codec><h264_settings><framerate_denominator>1</framerate_denominator><framerate_follow_source>false</framerate_follow_source><framerate_numerator>30</framerate_numerator><gop_size>60.0</gop_size><par_denominator>1</par_denominator><par_follow_source>false</par_follow_source><par_numerator>1</par_numerator><slices>4</slices><level>4.1</level><bitrate>2500000</bitrate><buf_size>5000000</buf_size></h264_settings><video_preprocessors><deinterlacer><algorithm>interpolate</algorithm><deinterlace_mode>Deinterlace</deinterlace_mode><force>false</force></deinterlacer></video_preprocessors></video_description><audio_description><audio_source_name>Audio Selector 1</audio_source_name><audio_type>0</audio_type><follow_input_audio_type>true</follow_input_audio_type><follow_input_language_code>true</follow_input_language_code><codec>aac</codec></audio_description></stream_assembly><output_group><type>apple_live_group_settings</type><apple_live_group_settings><cdn>Basic_PUT</cdn><destination><uri>http://delta-1-yanexx65s8e5.live.elementalclouddev.com/in_put/test</uri></destination></apple_live_group_settings><output><name_modifier>output</name_modifier><stream_assembly_name>SA1</stream_assembly_name><container>m3u8</container></output></output_group></live_event_profile>')

    # def teststripNameSpace(self):
    #     xml = "<?xml version='1.0' encoding='utf-8'?>\n<live_event>\n  <name>testX</name>\n  <profile>test_profile</profile>\n  <node_id>3</node_id>\n  <input>\n    <order>1</order>\n    <file_input>\n      <uri>https://s3-us-west-2.amazonaws.com/pdxteamdkrakatoa/big_buck_bunny.mp4</uri>\n    </file_input>\n  </input>\n</live_event>"
    #     xmlWithoutNamespace = "<live_event>\n  <name>testX</name>\n  <profile>test_profile</profile>\n  <node_id>3</node_id>\n  <input>\n    <order>1</order>\n    <file_input>\n      <uri>https://s3-us-west-2.amazonaws.com/pdxteamdkrakatoa/big_buck_bunny.mp4</uri>\n    </file_input>\n  </input>\n</live_event>"

    #     self.assertEqual(self.converter.stripNameSpace(xml).text,
    #                      xmlWithoutNamespace)


if __name__ == '__main__':
    unittest.main()
